import{_ as o,r as t,c as a,a as e,f as s,e as n,v as r,t as l,l as i,o as c}from"./index.CIxDUkZG.js";import{a as u,g as d}from"./data.BdDFeyDE.js";const g={class:"import-dishes"},m={class:"new-container"},p={class:"container-image"},f={class:"input-container"},v={key:0,class:"macaron-modal"},w={class:"modal-content"},h={class:"modal-text"},y=o({__name:"index",setup(o){const y=t(""),$=t(!1),C=t(""),P=async()=>{if(!y.value.trim())return;const o=y.value.trim();if(_(o))$.value=!0,C.value="小主！这道菜御膳房已经备了！";else try{console.log("调用扣子工作流，发送消息:",o);const t=await(async o=>{for(let e=0;e<3;e++)try{const a=await i();if(!a||!a.trim())throw new Error("无效的Coze API密钥");const s={workflow_id:"7576228389498798116",parameters:{USER_INPUT:o}};console.log(`调用扣子工作流 (第${e+1}次尝试)，发送请求:`,s);const n="https://api.coze.cn/v1/workflow/run";console.log("直接调用 Coze API，URL:",n);const r=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const o=await r.json().catch(()=>({}));throw new Error(`HTTP error! status: ${r.status} - ${JSON.stringify(o)}`)}const l=await r.json();if(console.log("扣子工作流API响应:",JSON.stringify(l,null,2)),0!==l.code)throw new Error(`工作流执行失败: ${l.msg||"未知错误"}`);if(l.data)try{const o=JSON.parse(l.data);if(console.log("解析后的数据:",o),o.output)return console.log("扣子工作流返回结果:",o.output),o}catch(t){console.error("解析 data 字段失败:",t),console.error("原始 data 字段:",l.data)}throw new Error("未找到工作流输出结果")}catch(a){if(console.error(`调用扣子工作流失败 (第${e+1}次尝试):`,a),2===e)throw a;await new Promise(o=>setTimeout(o,1500))}})(o);if(t&&t.output){const o=t.output;console.log("工作流返回的原始数据:",o);const a=o.map(o=>{const t=o.split(",");if(t.length<4)return console.error("无效的菜品数据格式（期望4个字段）:",o),null;const a=t[0].trim(),e=t[1].trim(),s=t[2].trim();return{name:s,category:a,subCategory:e,ingredients:[s],description:`${a} - ${e} - ${s}`,imageUrl:t[3].trim()}}).filter(o=>null!==o);console.log("转换后的菜品数据:",a);const e=u(a);e>0?(console.log(`成功添加 ${e} 道菜品到菜单数据库`),$.value=!0,C.value="小主，新菜菜已经入库啦！",y.value=""):(console.log("没有添加新菜品，可能已存在"),$.value=!0,C.value="小主，这些菜御膳房已经备了！")}}catch(t){console.error("处理扣子工作流结果失败:",t),$.value=!0,C.value="小主，网络有点不给力，稍后再试试吧！"}},_=o=>{if(!o)return!1;const t=o=>o.toLowerCase().replace(/[炖煮炒炸烧焖煎烤蒸烩拌]/g," ").split("").sort().join(""),a=t(o),e=d();for(const s of e){if(a===t(s.name))return!0}return!1};return(o,t)=>(c(),a("div",g,[e("div",m,[e("div",p,[t[2]||(t[2]=e("img",{class:"bg-image",src:"/qingqing/assets/reward.BNgf-p5R.png",alt:"悬赏图片"},null,-1)),e("div",f,[n(e("input",{type:"text",class:"center-input",placeholder:"小主想吃啥？","onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o)},null,512),[[r,y.value]])]),e("div",{class:"icon-container"},[e("img",{class:"input-icon",src:"/qingqing/assets/882269822396564_1764237444705701185.tif~tplv-e1ww11ta6z-normal.B-PqxACl.png",alt:"输入框图标",onClick:P})])])]),$.value?(c(),a("div",v,[e("div",w,[e("div",h,l(C.value),1),e("button",{class:"modal-btn",onClick:t[1]||(t[1]=o=>$.value=!1)},"准了")])])):s("",!0)]))}},[["__scopeId","data-v-d75f5f23"]]);export{y as default};
