import{_ as e,r as a,j as s,b as t,d as l,c as o,a as n,e as c,F as i,f as r,t as u,u as d,o as v,g as m,k as p,i as g,n as f,l as h}from"./index.D0pGnVOK.js";import{_ as w}from"./macaron_yellow_rgb.DN6hcqoj.js";import{getFeishuOrders as T,updateFeishuOrderStatus as y}from"./feishuApi.BtMD_xKQ.js";const b={class:"qing-male-index"},j={class:"main-content"},x={class:"recent-orders"},S={class:"order-list"},I={class:"order-header"},_=["onUpdate:modelValue","onChange"],k={class:"order-content"},C={class:"order-dish"},D={class:"order-time"},O={class:"order-price"},$={key:0,class:"custom-confirm"},E={class:"owed-counter"},U={class:"counter-value"},V=e({__name:"index",setup(e){d(),a(5),a(20),a("4.8");const V=a([]),q=a(!1),A=a({}),F=a(null);let z=null;const B=async()=>{try{console.log("从飞书表格加载菜品数据...");const e=(await T()).filter(e=>"rejected"!==e.status);V.value=e.map(e=>({id:e.id,name:e.name,status:e.status,statusText:e.status,createTime:e.createTime,time:e.time,price:"一个亲亲"})),V.value.forEach(e=>{A.value[e.id]=e.status||"pending"}),console.log(`从飞书表格加载了 ${V.value.length} 条有效订单数据`)}catch(e){console.error("从飞书表格加载菜品数据失败:",e)}},G=()=>{z&&(console.log("停止订单数据轮询"),clearInterval(z),z=null)},H=s(()=>{const e=(new Date).toISOString().split("T")[0];return V.value.filter(a=>new Date(a.createTime).toISOString().split("T")[0]===e).length});t(async()=>{console.log("清宫男厨师端首页加载"),await B(),console.log("启动订单数据轮询，间隔",30,"秒"),G(),z=setInterval(B,3e4),console.log("当前日期:",(new Date).toISOString().split("T")[0]),console.log("所有菜品:",V.value),console.log("当天已完成菜品:",V.value.filter(e=>{const a=e.createTime?new Date(e.createTime).toISOString().split("T")[0]:"";return"completed"===e.status&&a===(new Date).toISOString().split("T")[0]}))}),l(()=>{G()});const J=async()=>{F.value&&F.value.name&&(navigator.clipboard.writeText(F.value.name).then(()=>{console.log("菜肴名称已复制到剪贴板:",F.value.name)}).catch(e=>{console.error("复制失败:",e)}),await L(F.value,"rejected")),q.value=!1,F.value=null},K=async()=>{F.value&&await L(F.value,"rejected"),q.value=!1,F.value=null},L=async(e,a)=>{try{await y(e.id,a);const s=V.value.filter(a=>a.id!==e.id);V.value=s,V.value.forEach(e=>{A.value[e.id]=e.status}),console.log(`菜品状态已更新为${a}`)}catch(s){console.error("更新飞书订单状态失败:",s),A.value[e.id]=e.status}};return(e,a)=>(v(),o("div",b,[a[7]||(a[7]=n("div",{class:"custom-navbar"},[n("div",{class:"nav-left"}),n("div",{class:"nav-right"})],-1)),n("div",j,[n("div",x,[a[3]||(a[3]=n("h2",{class:"section-title"},"小主旨意",-1)),n("div",S,[(v(!0),o(i,null,r(V.value,e=>(v(),o("div",{class:"order-item",key:e.id},[n("div",I,[m(n("select",{class:f(["order-status-select",A.value[e.id]]),"onUpdate:modelValue":a=>A.value[e.id]=a,onChange:a=>(async e=>{const a={pending:"待处理",processing:"制作中",completed:"已完成",rejected:"驳回/删除"},s=A.value[e.id];if("rejected"===s)F.value=e,q.value=!0,A.value[e.id]=e.status;else try{await y(e.id,s),e.status=s,e.statusText=a[s],console.log(`菜品状态已更新为${e.statusText}`)}catch(t){console.error("更新飞书订单状态失败:",t),A.value[e.id]=e.status}})(e),onClick:a[0]||(a[0]=g(()=>{},["stop"]))},[...a[1]||(a[1]=[n("option",{value:"pending"},"待处理",-1),n("option",{value:"processing"},"制作中",-1),n("option",{value:"completed"},"已完成",-1),n("option",{value:"rejected"},"驳回/删除",-1)])],42,_),[[p,A.value[e.id]]])]),n("div",k,[n("span",C,u(e.name),1),n("span",D,u(e.time),1)]),n("div",O,[a[2]||(a[2]=n("img",{src:w,alt:"马卡龙黄色",class:"price-icon"},null,-1)),h(" "+u(e.price),1)])]))),128))])])]),q.value?(v(),o("div",$,[n("div",{class:"confirm-content"},[a[4]||(a[4]=n("p",{class:"confirm-text"},"菜菜：你不要菜菜了吗？",-1)),n("div",{class:"confirm-buttons"},[n("button",{class:"confirm-btn reject-btn",onClick:J},"驳回"),n("button",{class:"confirm-btn delete-btn",onClick:K},"删除")])])])):c("",!0),n("div",E,[a[5]||(a[5]=n("img",{class:"counter-icon",src:w,alt:"马卡龙黄色"},null,-1)),a[6]||(a[6]=n("span",{class:"counter-text"},"已欠亲亲",-1)),n("span",U,u(H.value),1)])]))}},[["__scopeId","data-v-21291072"]]);export{V as default};
