const e="https://open.larksuite.com/open-apis",t="cli_a9ae903f207bdbcb",n="DLR7udnlQ8uDfyU9DPNhVeV1F6xKZoLs",r="V5CFbM5fZaCJRBsviBucYxnxnEe",o="tblg1qsIFjb2tazd",s="qingqing_feishu_dishes",i=864e5;async function a(){const a=function(){try{const e=localStorage.getItem(s);if(!e)return null;const{data:t,timestamp:n}=JSON.parse(e);return Date.now()-n>i?(localStorage.removeItem(s),null):t}catch(e){return console.error("从缓存获取数据错误:",e),localStorage.removeItem(s),null}}();if(a)return console.log("使用缓存的菜肴数据"),a;try{const i=await async function(){try{const r=`${e}/auth/v3/tenant_access_token/internal`,o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Node.js/24.11.1"},body:JSON.stringify({app_id:t,app_secret:n})});if(!o.ok)throw new Error(`获取飞书访问令牌失败: ${o.status}`);const s=await o.json();if(0!==s.code)throw new Error(`飞书API错误: ${s.msg}`);return s.tenant_access_token}catch(r){throw console.error("获取飞书访问令牌错误:",r),r}}(),a=await async function(t){try{const n=`${e}/bitable/v1/apps/${r}/tables/${o}/records`,s=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","User-Agent":"Node.js/24.11.1"}});if(!s.ok)throw new Error(`获取飞书表格数据失败: ${s.status}`);const i=await s.json();if(0!==i.code)throw new Error(`飞书API错误: ${i.msg}`);return i.data.items}catch(n){throw console.error("获取飞书表格数据错误:",n),n}}(i),c=a.map((e,t)=>{const n=e.fields;return{id:`dish-${String(t+1).padStart(4,"0")}`,name:n["菜肴名称"]||"",category:n["一级分类"]||"",subCategory:n["二级分类"]||"",ingredients:[n["二级分类"]||""],imageUrl:n.url||"",price:"一个亲亲"}});return function(e){try{const t={data:e,timestamp:Date.now()};localStorage.setItem(s,JSON.stringify(t))}catch(t){console.error("缓存数据错误:",t)}}(c),console.log(`从飞书获取 ${c.length} 条菜肴数据`),c}catch(c){return console.error("获取飞书菜肴数据错误:",c),[]}}class c{constructor(e,t,n,r){this.id=e,this.name=t,this.category=n,this.description=r,this.dishes=[]}}class l{constructor(e,t,n,r,o,s,i){this.id=e,this.name=t,this.category=n,this.subCategory=r,this.ingredients=o,this.imageUrl=s,this.price=i}}const g=[new c("ingredient-001","大米","主食","主要粮食作物"),new c("ingredient-002","面粉","主食","制作面食的主要原料"),new c("ingredient-003","白菜","蔬菜","常见蔬菜"),new c("ingredient-004","豆腐","豆制品","传统豆制品"),new c("ingredient-005","猪肉","肉类","常见肉类"),new c("ingredient-006","鸡肉","肉类","常见禽类"),new c("ingredient-007","牛肉","肉类","高蛋白肉类"),new c("ingredient-008","鱼","海鲜","常见水产"),new c("ingredient-009","虾","海鲜","高蛋白水产"),new c("ingredient-010","鸡蛋","蛋类","常见蛋类")];let h=[];function d(){h.forEach(e=>{e.ingredients.forEach(t=>{const n=g.find(e=>e.name===t);n&&!n.dishes.includes(e.id)&&n.dishes.push(e.id)})})}function u(){return[...h]}function f(e){try{if(h.find(t=>t.name===e.name))return console.log("菜品已存在，跳过:",e.name),!1;const t=`dish-${String(h.length+1).padStart(3,"0")}`,n=new l(t,e.name,e.category,e.subCategory,e.ingredients||[e.subCategory],e.imageUrl,e.price||"一个亲亲");return h.push(n),console.log("成功添加菜品:",n),d(),!0}catch(t){return console.error("添加菜品失败:",t),!1}}function p(e){let t=0;for(const n of e)f(n)&&t++;return console.log(`批量添加完成，共添加 ${t} 道菜品`),t}!async function(){try{const e=await a();h.length=0,h.push(...e),d(),console.log(`成功从飞书加载 ${h.length} 道菜品`)}catch(e){console.error("从飞书加载数据失败:",e)}}();export{p as a,u as g};
